<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps API Key Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #map { height: 400px; width: 100%; margin: 20px 0; border: 2px solid #ddd; border-radius: 8px; }
        button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 8px 4px; font-size: 14px; }
        button:hover { background: #0056b3; }
        .test-results { margin-top: 20px; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üó∫Ô∏è Google Maps API Key Test</h1>
        
        <div id="api-status" class="status info">
            üîÑ Testing API key: AIzaSyBpCEVGRZdKPjSVQD0Wd6yVlqUc9FVsR6o
        </div>

        <div class="test-results">
            <h3>üß™ API Tests:</h3>
            <button onclick="testBasicMap()">üó∫Ô∏è Test Basic Map Loading</button>
            <button onclick="testPlacesAPI()">üìç Test Places API</button>
            <button onclick="testGeocoding()">üåç Test Geocoding API</button>
            <button onclick="testTajMahalMarker()">üïå Test Taj Mahal Marker</button>
            <button onclick="clearTests()">üßπ Clear Results</button>
        </div>

        <div id="map"></div>

        <div id="test-log" class="log">
            API Key Test Log:<br>
            Current restrictions allow: file://* localhost:* 127.0.0.1:* *<br>
            <br>
        </div>
    </div>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBpCEVGRZdKPjSVQD0Wd6yVlqUc9FVsR6o&libraries=places&callback=initializeTests" async defer></script>

    <script>
        let map;
        let placesService;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                success: '#28a745',
                error: '#dc3545', 
                warning: '#ffc107',
                info: '#17a2b8'
            };
            const color = colors[type] || '#000';
            logDiv.innerHTML += `<span style="color: ${color}; font-weight: bold;">[${timestamp}] ${message}</span><br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[API TEST] ${message}`);
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('api-status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        function initializeTests() {
            log('Google Maps API loaded successfully!', 'success');
            updateStatus('‚úÖ Google Maps API loaded successfully! Key is working.', 'success');
            
            // Initialize map centered on India
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 20.5937, lng: 78.9629 }, // Center of India
                zoom: 5,
                mapTypeId: 'roadmap'
            });
            
            placesService = new google.maps.places.PlacesService(map);
            log('Map initialized and Places service ready', 'success');
        }

        function testBasicMap() {
            log('Testing basic map functionality...', 'info');
            
            if (!map) {
                log('ERROR: Map not initialized', 'error');
                return;
            }
            
            try {
                // Test map controls
                map.setCenter({ lat: 28.6139, lng: 77.2090 }); // Delhi
                map.setZoom(10);
                
                // Add a test marker
                const marker = new google.maps.Marker({
                    position: { lat: 28.6139, lng: 77.2090 },
                    map: map,
                    title: 'Delhi - API Test Marker'
                });
                
                log('‚úÖ Basic map controls working (center, zoom, markers)', 'success');
                
                // Test info window
                const infoWindow = new google.maps.InfoWindow({
                    content: '<div><strong>Delhi</strong><br>API Key Test Location</div>'
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                    log('‚úÖ Info windows working', 'success');
                });
                
                log('‚úÖ Basic map test completed successfully', 'success');
                
            } catch (error) {
                log(`‚ùå Basic map test failed: ${error.message}`, 'error');
            }
        }

        function testPlacesAPI() {
            log('Testing Places API...', 'info');
            
            if (!placesService) {
                log('ERROR: Places service not available', 'error');
                return;
            }
            
            // Test Places API with Taj Mahal
            const request = {
                query: 'Taj Mahal Agra India',
                fields: ['name', 'geometry', 'place_id', 'formatted_address', 'rating']
            };
            
            placesService.findPlaceFromQuery(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                    const place = results[0];
                    log(`‚úÖ Places API working! Found: ${place.name}`, 'success');
                    log(`üìç Location: ${place.formatted_address}`, 'info');
                    log(`‚≠ê Rating: ${place.rating || 'N/A'}`, 'info');
                    log(`üÜî Place ID: ${place.place_id}`, 'info');
                    
                    // Add marker for found place
                    const marker = new google.maps.Marker({
                        position: place.geometry.location,
                        map: map,
                        title: place.name
                    });
                    
                    map.setCenter(place.geometry.location);
                    map.setZoom(15);
                    
                } else {
                    log(`‚ùå Places API failed with status: ${status}`, 'error');
                    if (status === 'REQUEST_DENIED') {
                        log('‚ö†Ô∏è REQUEST_DENIED - Check API key restrictions and Places API billing', 'warning');
                    }
                }
            });
        }

        function testGeocoding() {
            log('Testing Geocoding API...', 'info');
            
            const geocoder = new google.maps.Geocoder();
            
            geocoder.geocode({ address: 'India Gate, New Delhi, India' }, (results, status) => {
                if (status === 'OK' && results) {
                    const location = results[0].geometry.location;
                    log(`‚úÖ Geocoding working! India Gate location found`, 'success');
                    log(`üìç Coordinates: ${location.lat()}, ${location.lng()}`, 'info');
                    
                    // Add marker
                    const marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        title: 'India Gate (Geocoded)'
                    });
                    
                    map.setCenter(location);
                    map.setZoom(16);
                    
                } else {
                    log(`‚ùå Geocoding failed with status: ${status}`, 'error');
                }
            });
        }

        function testTajMahalMarker() {
            log('Testing Taj Mahal marker (matching your app data)...', 'info');
            
            // Taj Mahal coordinates from your INDIAN_TOURIST_PLACES data
            const tajMahal = {
                lat: 27.1751, 
                lng: 78.0421,
                name: 'Taj Mahal',
                description: 'UNESCO World Heritage Site and symbol of love'
            };
            
            try {
                // Center map on Taj Mahal
                map.setCenter(tajMahal);
                map.setZoom(17);
                
                // Create marker
                const marker = new google.maps.Marker({
                    position: tajMahal,
                    map: map,
                    title: tajMahal.name,
                    animation: google.maps.Animation.DROP
                });
                
                // Create info window
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="max-width: 200px;">
                            <h3>${tajMahal.name}</h3>
                            <p>${tajMahal.description}</p>
                            <p><strong>Coordinates:</strong><br>
                            ${tajMahal.lat}, ${tajMahal.lng}</p>
                        </div>
                    `
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });
                
                // Auto-open info window
                setTimeout(() => {
                    infoWindow.open(map, marker);
                }, 1000);
                
                log('‚úÖ Taj Mahal marker test successful!', 'success');
                log('üìç Marker placed at coordinates from your app data', 'info');
                
            } catch (error) {
                log(`‚ùå Taj Mahal marker test failed: ${error.message}`, 'error');
            }
        }

        function clearTests() {
            document.getElementById('test-log').innerHTML = 'Test log cleared...<br><br>';
            if (map) {
                // Clear all markers by creating a new map
                map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: 20.5937, lng: 78.9629 },
                    zoom: 5,
                    mapTypeId: 'roadmap'
                });
                placesService = new google.maps.places.PlacesService(map);
            }
            updateStatus('üîÑ Tests cleared. Ready for new tests.', 'info');
        }

        // Handle API loading errors
        window.gm_authFailure = function() {
            log('‚ùå AUTHENTICATION FAILURE - Invalid API key or restrictions', 'error');
            updateStatus('‚ùå API Authentication Failed - Check your key and restrictions', 'error');
        };

        // Fallback if API doesn't load
        setTimeout(() => {
            if (typeof google === 'undefined') {
                log('‚ùå Google Maps API failed to load completely', 'error');
                updateStatus('‚ùå API Loading Failed - Check network and key restrictions', 'error');
            }
        }, 10000);
    </script>
</body>
</html>
